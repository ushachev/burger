// const humbButton = document.querySelector(".humburger-menu-btn");
// const template = document.querySelector("#overlay-menu").innerHTML;
// const section = document.querySelector(".start");

// const overlayMenu = createMenu(template);

// // humbButton.addEventListener('click', function() {
// // 	overlayMenu.open();
// // 	this.classList.toggle('humburger-menu-btn_clicked');
// // });

// function createMenu(templateIn) {
// 	let tempBlock = document.createElement('div');

// 	tempBlock.innerHTML = templateIn;

// 	let closeElem = tempBlock.querySelector(".humburger-menu-btn");
// 	let menuElem = tempBlock.querySelector(".overlay-menu");

// 	tempBlock = null;

// 	menuElem.addEventListener('click', function(e) {
// 		let target = e.target;
// 		if (target.className === 'nav-menu__link') {
// 			closeElem.click();
// 		}
// 		if (target === menuElem) {
// 			closeElem.classList.toggle('humburger-menu-btn_clicked');
// 		}
// 	})

// 	closeElem.addEventListener('click', function() {
// 		section.removeChild(menuElem);
// 		humbButton.classList.toggle('humburger-menu-btn_clicked');
// 	})

// 	return {
// 		open() {
// 			section.appendChild(menuElem);
// 		}
// 	} 
// }
// ============================================

let overlay = (function(options) {
	let button = document.querySelector(options.button);
	let overlay = document.querySelector(options.overlay);
	let menuItems = overlay.querySelectorAll(".nav-menu__item");

	let counter = 0;

	let _menuAnimation = function() {
		menuItems[counter].classList.toggle("nav-menu__item_overlay");
		counter++;
		if (counter < menuItems.length) {
			setTimeout(_menuAnimation, 100);
		} else {
			counter = 0;
		}
		// (counter < menuItems.length) ? setTimeout(_menuAnimation, 100) : counter = 0;
	}

	let _toggleOverlay = function() {
		document.querySelector("body").classList.toggle("disabled-onepage-scroll");
		button.classList.toggle("humburger-menu-btn_clicked");
		overlay.classList.toggle("header_overlay");
		_menuAnimation();
	}

	let addListeners = function() {
		button.addEventListener('click', _toggleOverlay);
		button.addEventListener('keydown', function(e) {
			e.preventDefault();
		})
		overlay.addEventListener('click', function(e) {
			if (e.target.className === 'nav-menu__link' && 
				button.classList.contains("humburger-menu-btn_clicked")) {
				_toggleOverlay();
			}
		});
	}

	return {
		init: addListeners
	};
})({
	button: ".humburger-menu-btn",
	overlay: ".header"
})

overlay.init();

// ==============================

let accordeon = (function(options) {
	let accordBlock = document.querySelector(options.block);
	let isClicked = false;
	let isAnimOver = true;

	let _toggleAccordeon = function(elem) {
		if (isClicked) {
			let activeItem = accordBlock.querySelector("." + options.item);
			activeItem.classList.remove(options.item);
			activeItem.querySelector("." + options.content).style.height = 0;
		}
		elem.classList.toggle(options.item);
		let elemContent = elem.querySelector("." + options.content);
		elemContent.style.height = elemContent.scrollHeight + "px";
		isClicked = true;
	}

	let addListener = function() {
		accordBlock.addEventListener('click', function(e) {
			let itemClicked = e.target.parentElement;
			let isTrigger = (e.target.className === options.trigger);
			if (isTrigger && isAnimOver
				&& itemClicked.classList.contains(options.item)) {
					itemClicked.classList.remove(options.item);
					itemClicked.querySelector("." + options.content).style.height = 0;
					isClicked = false;
					isAnimOver = false;
					setTimeout(function() {isAnimOver = true;}, 600);
			} else if (isTrigger && isAnimOver) {
				_toggleAccordeon(itemClicked);
				isAnimOver = false;
				setTimeout(function() {isAnimOver = true;}, 600);
			}
		})
	}

	return {
		init: addListener
	};
})({
	block: ".accordeon",
	trigger: "accordeon__item-title",
	item: "accordeon__item_active",
	content: "accordeon__content"
})

accordeon.init();

// ======================================

let accordeonHor = (function(options) {
	let accordBlock = document.querySelector(options.block);
	let triggerWidth;
	let isClicked = false;
	let isPhone = window.innerWidth <= 480;
	if (isPhone) {
		accordBlock.style.left = accordBlock.getBoundingClientRect().left + 'px';
	}

	let _widthContent = function() {
		let itemQuantity = 3;
		if (isPhone) {itemQuantity = 1;}
		let computedWidth = window.innerWidth - itemQuantity * triggerWidth;

		return computedWidth > 540 ? 540 : computedWidth;
	}

	let _toggleAccordeon = function(elem) {
		let initialLeft = window.innerWidth - 3 * triggerWidth + 'px';
		if (isClicked) {
			let isOpenedItemClicked = elem.classList.contains(options.item);
			let activeItem = accordBlock.querySelector("." + options.item);
			activeItem.classList.toggle(options.item);
			activeItem.querySelector('.' + options.content).style.width = 0;
			isClicked = false;
			if (isOpenedItemClicked) {
				if (isPhone) {
					accordBlock.style.left = initialLeft;}
				return;
			}
		}
		elem.classList.toggle(options.item);
		let elemContent = elem.querySelector('.' + options.content);
		elemContent.style.width = _widthContent() + 'px';
		if (isPhone) {
			accordBlock.style.left = [].indexOf.call(accordBlock.children, elem) * 
			-(triggerWidth) + 'px';
		}
		isClicked = true;
	}

	let addListeners = function() {
		accordBlock.addEventListener('click', function(e) {
			let target = e.target.closest('.' + options.trigger);
			isPhone = window.innerWidth <= 480;
			triggerWidth = parseInt(getComputedStyle(accordBlock
				.querySelector('.' + options.trigger)).width);
			if (target) {
				_toggleAccordeon(target.parentElement);}
		})

		let crosses = accordBlock.querySelectorAll('.accordeon-hor__btn-close');
		for (let i = 0; i < crosses.length; i++) {
			crosses[i].addEventListener('click', function(e) {
			_toggleAccordeon(crosses[i].closest('.' + options.item))
		})
		}
		
	}

	return {init: addListeners};
})({
	block: ".accordeon-hor",
	trigger: "accordeon-hor__title",
	item: "accordeon-hor__item_active",
	content: "accordeon-hor__container"
})

accordeonHor.init();

// =====================================================

const moreButtons = document.querySelectorAll(".review__more-btn");
const templateRev = document.querySelector("#overlay-review").innerHTML;
const sectionRev = document.querySelector(".review");

const overlayReview = createReview(templateRev);

for (var i = 0; i < moreButtons.length; i++) {
	moreButtons[i].addEventListener('click', function(e) {
		let target = e.target.closest(".review__more-btn");
		if (target) {
			document.querySelector("body").classList.add("disabled-onepage-scroll");
			overlayReview.open(target.parentElement);
		}
	})
}

function createReview(templateIn) {
	let tempBlock = document.createElement('div');

	tempBlock.innerHTML = templateIn;

	let closeElem = tempBlock.querySelector(".overlay-review__btn-close");
	let overlayElem = tempBlock.querySelector(".overlay-review");
	let authorElem = tempBlock.querySelector(".overlay-review__title");
	let textElem = tempBlock.querySelector(".overlay-review__text");

	tempBlock = null;

	overlayElem.addEventListener('click', function(e) {
		if (e.target === overlayElem) {
			closeElem.click();
		}
	})

	closeElem.addEventListener('click', function() {
		document.querySelector("body").classList.remove("disabled-onepage-scroll");
		sectionRev.removeChild(overlayElem);
	})

	return {
		open(item) {
			sectionRev.appendChild(overlayElem);
			authorElem.innerHTML = item.querySelector(".review__author").innerHTML;
			textElem.innerHTML = item.querySelector(".review__text").innerHTML;
		}
	}
}

// ==============================================

const owlBurger = $('.owl-carousel');

$(document).ready(function(){
	owlBurger.owlCarousel({
		loop: true,
		items: 1
	});
});

$('.burgers__prev').click(function() {
    owlBurger.trigger('prev.owl.carousel');
})

$('.burgers__next').click(function() {
    owlBurger.trigger('next.owl.carousel');
})

// =============================================

$(".main").onepage_scroll({
   sectionContainer: "section",     // sectionContainer accepts any kind of selector in case you don't want to use section
   easing: "ease",                  // Easing options accepts the CSS3 easing animation such "ease", "linear", "ease-in",
                                    // "ease-out", "ease-in-out", or even cubic bezier value such as "cubic-bezier(0.175, 0.885, 0.420, 1.310)"
   animationTime: 1000,             // AnimationTime let you define how long each section takes to animate
   pagination: true,                // You can either show or hide the pagination. Toggle true for show, false for hide.
   updateURL: false,                // Toggle this true if you want the URL to be updated automatically when the user scroll to each page.
   beforeMove: function(index) {},  // This option accepts a callback function. The function will be called before the page moves.
   afterMove: function(index) {},   // This option accepts a callback function. The function will be called after the page moves.
   loop: false,                     // You can have the page loop back to the top/bottom when the user navigates at up/down on the first/last page.
   keyboard: true,                  // You can activate the keyboard controls
   responsiveFallback: false,        // You can fallback to normal page scroll by defining the width of the browser in which
                                    // you want the responsive fallback to be triggered. For example, set this to 600 and whenever
                                    // the browser's width is less than 600, the fallback will kick in.
   direction: "vertical"            // You can now define the direction of the One Page Scroll animation. Options available are "vertical" and "horizontal". The default value is "vertical".  
});

// ==============================================

let navigation = function() {
	let startPage = document.querySelector('.start');

	startPage.addEventListener('click', function(e) {
		if (e.target.className === 'nav-menu__link' || 
			e.target.classList.contains('main-nav__btn') ||
			e.target.classList.contains('start__page-down')) {
			e.preventDefault();
			$('.main').moveTo(e.target.dataset.index);
		}
	})
}

navigation();

// ==========================================

let submitOrder = (function() {
	let form = $('#order-form');

	let displayModal = function(message) {
		const sectionOrder = document.querySelector('.order');

		let tempBlock = document.createElement('div');
		tempBlock.innerHTML = document.querySelector('#overlay-order').innerHTML;

		let closeElem = tempBlock.querySelector('.overlay-order__btn');
		let overlayElem = tempBlock.querySelector(".overlay-order");
		let textElem = tempBlock.querySelector(".overlay-order__text");

		tempBlock = null;

		textElem.innerHTML = message;
		document.querySelector("body").classList.add("disabled-onepage-scroll");
		sectionOrder.appendChild(overlayElem);

		overlayElem.addEventListener('click', function(e) {
			if (e.target === overlayElem) {
				closeElem.click();
			}
		})

		closeElem.addEventListener('click', function() {
			document.querySelector("body").classList.remove("disabled-onepage-scroll");
			sectionOrder.removeChild(overlayElem);
		})
	}

	let addListener = function() {
		form.on('submit', function(e) {
			e.preventDefault();

			let	data = form.serialize(),
				type = form.attr('method'),
				url = form.attr('action');

			let request = $.ajax({
				type: type,
				url: url,
				dataType: 'JSON',
				data: data
			}).done(function(msg) {
				displayModal(msg.mes);
			}).fail(function(jqXHR, textStatus) {
		        alert("Request failed: " + textStatus);
		    });
		})
	}

	return {init: addListener};
})();

submitOrder.init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBjb25zdCBodW1iQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5odW1idXJnZXItbWVudS1idG5cIik7XHJcbi8vIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNvdmVybGF5LW1lbnVcIikuaW5uZXJIVE1MO1xyXG4vLyBjb25zdCBzZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zdGFydFwiKTtcclxuXHJcbi8vIGNvbnN0IG92ZXJsYXlNZW51ID0gY3JlYXRlTWVudSh0ZW1wbGF0ZSk7XHJcblxyXG4vLyAvLyBodW1iQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbi8vIC8vIFx0b3ZlcmxheU1lbnUub3BlbigpO1xyXG4vLyAvLyBcdHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgnaHVtYnVyZ2VyLW1lbnUtYnRuX2NsaWNrZWQnKTtcclxuLy8gLy8gfSk7XHJcblxyXG4vLyBmdW5jdGlvbiBjcmVhdGVNZW51KHRlbXBsYXRlSW4pIHtcclxuLy8gXHRsZXQgdGVtcEJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG4vLyBcdHRlbXBCbG9jay5pbm5lckhUTUwgPSB0ZW1wbGF0ZUluO1xyXG5cclxuLy8gXHRsZXQgY2xvc2VFbGVtID0gdGVtcEJsb2NrLnF1ZXJ5U2VsZWN0b3IoXCIuaHVtYnVyZ2VyLW1lbnUtYnRuXCIpO1xyXG4vLyBcdGxldCBtZW51RWxlbSA9IHRlbXBCbG9jay5xdWVyeVNlbGVjdG9yKFwiLm92ZXJsYXktbWVudVwiKTtcclxuXHJcbi8vIFx0dGVtcEJsb2NrID0gbnVsbDtcclxuXHJcbi8vIFx0bWVudUVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbi8vIFx0XHRsZXQgdGFyZ2V0ID0gZS50YXJnZXQ7XHJcbi8vIFx0XHRpZiAodGFyZ2V0LmNsYXNzTmFtZSA9PT0gJ25hdi1tZW51X19saW5rJykge1xyXG4vLyBcdFx0XHRjbG9zZUVsZW0uY2xpY2soKTtcclxuLy8gXHRcdH1cclxuLy8gXHRcdGlmICh0YXJnZXQgPT09IG1lbnVFbGVtKSB7XHJcbi8vIFx0XHRcdGNsb3NlRWxlbS5jbGFzc0xpc3QudG9nZ2xlKCdodW1idXJnZXItbWVudS1idG5fY2xpY2tlZCcpO1xyXG4vLyBcdFx0fVxyXG4vLyBcdH0pXHJcblxyXG4vLyBcdGNsb3NlRWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4vLyBcdFx0c2VjdGlvbi5yZW1vdmVDaGlsZChtZW51RWxlbSk7XHJcbi8vIFx0XHRodW1iQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2h1bWJ1cmdlci1tZW51LWJ0bl9jbGlja2VkJyk7XHJcbi8vIFx0fSlcclxuXHJcbi8vIFx0cmV0dXJuIHtcclxuLy8gXHRcdG9wZW4oKSB7XHJcbi8vIFx0XHRcdHNlY3Rpb24uYXBwZW5kQ2hpbGQobWVudUVsZW0pO1xyXG4vLyBcdFx0fVxyXG4vLyBcdH0gXHJcbi8vIH1cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmxldCBvdmVybGF5ID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRsZXQgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmJ1dHRvbik7XHJcblx0bGV0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMub3ZlcmxheSk7XHJcblx0bGV0IG1lbnVJdGVtcyA9IG92ZXJsYXkucXVlcnlTZWxlY3RvckFsbChcIi5uYXYtbWVudV9faXRlbVwiKTtcclxuXHJcblx0bGV0IGNvdW50ZXIgPSAwO1xyXG5cclxuXHRsZXQgX21lbnVBbmltYXRpb24gPSBmdW5jdGlvbigpIHtcclxuXHRcdG1lbnVJdGVtc1tjb3VudGVyXS5jbGFzc0xpc3QudG9nZ2xlKFwibmF2LW1lbnVfX2l0ZW1fb3ZlcmxheVwiKTtcclxuXHRcdGNvdW50ZXIrKztcclxuXHRcdGlmIChjb3VudGVyIDwgbWVudUl0ZW1zLmxlbmd0aCkge1xyXG5cdFx0XHRzZXRUaW1lb3V0KF9tZW51QW5pbWF0aW9uLCAxMDApO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y291bnRlciA9IDA7XHJcblx0XHR9XHJcblx0XHQvLyAoY291bnRlciA8IG1lbnVJdGVtcy5sZW5ndGgpID8gc2V0VGltZW91dChfbWVudUFuaW1hdGlvbiwgMTAwKSA6IGNvdW50ZXIgPSAwO1xyXG5cdH1cclxuXHJcblx0bGV0IF90b2dnbGVPdmVybGF5ID0gZnVuY3Rpb24oKSB7XHJcblx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keVwiKS5jbGFzc0xpc3QudG9nZ2xlKFwiZGlzYWJsZWQtb25lcGFnZS1zY3JvbGxcIik7XHJcblx0XHRidXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImh1bWJ1cmdlci1tZW51LWJ0bl9jbGlja2VkXCIpO1xyXG5cdFx0b3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKFwiaGVhZGVyX292ZXJsYXlcIik7XHJcblx0XHRfbWVudUFuaW1hdGlvbigpO1xyXG5cdH1cclxuXHJcblx0bGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3RvZ2dsZU92ZXJsYXkpO1xyXG5cdFx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdH0pXHJcblx0XHRvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09PSAnbmF2LW1lbnVfX2xpbmsnICYmIFxyXG5cdFx0XHRcdGJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJodW1idXJnZXItbWVudS1idG5fY2xpY2tlZFwiKSkge1xyXG5cdFx0XHRcdF90b2dnbGVPdmVybGF5KCk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH07XHJcbn0pKHtcclxuXHRidXR0b246IFwiLmh1bWJ1cmdlci1tZW51LWJ0blwiLFxyXG5cdG92ZXJsYXk6IFwiLmhlYWRlclwiXHJcbn0pXHJcblxyXG5vdmVybGF5LmluaXQoKTtcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxubGV0IGFjY29yZGVvbiA9IChmdW5jdGlvbihvcHRpb25zKSB7XHJcblx0bGV0IGFjY29yZEJsb2NrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmJsb2NrKTtcclxuXHRsZXQgaXNDbGlja2VkID0gZmFsc2U7XHJcblx0bGV0IGlzQW5pbU92ZXIgPSB0cnVlO1xyXG5cclxuXHRsZXQgX3RvZ2dsZUFjY29yZGVvbiA9IGZ1bmN0aW9uKGVsZW0pIHtcclxuXHRcdGlmIChpc0NsaWNrZWQpIHtcclxuXHRcdFx0bGV0IGFjdGl2ZUl0ZW0gPSBhY2NvcmRCbG9jay5xdWVyeVNlbGVjdG9yKFwiLlwiICsgb3B0aW9ucy5pdGVtKTtcclxuXHRcdFx0YWN0aXZlSXRlbS5jbGFzc0xpc3QucmVtb3ZlKG9wdGlvbnMuaXRlbSk7XHJcblx0XHRcdGFjdGl2ZUl0ZW0ucXVlcnlTZWxlY3RvcihcIi5cIiArIG9wdGlvbnMuY29udGVudCkuc3R5bGUuaGVpZ2h0ID0gMDtcclxuXHRcdH1cclxuXHRcdGVsZW0uY2xhc3NMaXN0LnRvZ2dsZShvcHRpb25zLml0ZW0pO1xyXG5cdFx0bGV0IGVsZW1Db250ZW50ID0gZWxlbS5xdWVyeVNlbGVjdG9yKFwiLlwiICsgb3B0aW9ucy5jb250ZW50KTtcclxuXHRcdGVsZW1Db250ZW50LnN0eWxlLmhlaWdodCA9IGVsZW1Db250ZW50LnNjcm9sbEhlaWdodCArIFwicHhcIjtcclxuXHRcdGlzQ2xpY2tlZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcclxuXHRcdGFjY29yZEJsb2NrLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRsZXQgaXRlbUNsaWNrZWQgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50O1xyXG5cdFx0XHRsZXQgaXNUcmlnZ2VyID0gKGUudGFyZ2V0LmNsYXNzTmFtZSA9PT0gb3B0aW9ucy50cmlnZ2VyKTtcclxuXHRcdFx0aWYgKGlzVHJpZ2dlciAmJiBpc0FuaW1PdmVyXHJcblx0XHRcdFx0JiYgaXRlbUNsaWNrZWQuY2xhc3NMaXN0LmNvbnRhaW5zKG9wdGlvbnMuaXRlbSkpIHtcclxuXHRcdFx0XHRcdGl0ZW1DbGlja2VkLmNsYXNzTGlzdC5yZW1vdmUob3B0aW9ucy5pdGVtKTtcclxuXHRcdFx0XHRcdGl0ZW1DbGlja2VkLnF1ZXJ5U2VsZWN0b3IoXCIuXCIgKyBvcHRpb25zLmNvbnRlbnQpLnN0eWxlLmhlaWdodCA9IDA7XHJcblx0XHRcdFx0XHRpc0NsaWNrZWQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdGlzQW5pbU92ZXIgPSBmYWxzZTtcclxuXHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7aXNBbmltT3ZlciA9IHRydWU7fSwgNjAwKTtcclxuXHRcdFx0fSBlbHNlIGlmIChpc1RyaWdnZXIgJiYgaXNBbmltT3Zlcikge1xyXG5cdFx0XHRcdF90b2dnbGVBY2NvcmRlb24oaXRlbUNsaWNrZWQpO1xyXG5cdFx0XHRcdGlzQW5pbU92ZXIgPSBmYWxzZTtcclxuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge2lzQW5pbU92ZXIgPSB0cnVlO30sIDYwMCk7XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblx0fVxyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJcclxuXHR9O1xyXG59KSh7XHJcblx0YmxvY2s6IFwiLmFjY29yZGVvblwiLFxyXG5cdHRyaWdnZXI6IFwiYWNjb3JkZW9uX19pdGVtLXRpdGxlXCIsXHJcblx0aXRlbTogXCJhY2NvcmRlb25fX2l0ZW1fYWN0aXZlXCIsXHJcblx0Y29udGVudDogXCJhY2NvcmRlb25fX2NvbnRlbnRcIlxyXG59KVxyXG5cclxuYWNjb3JkZW9uLmluaXQoKTtcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5sZXQgYWNjb3JkZW9uSG9yID0gKGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRsZXQgYWNjb3JkQmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuYmxvY2spO1xyXG5cdGxldCB0cmlnZ2VyV2lkdGg7XHJcblx0bGV0IGlzQ2xpY2tlZCA9IGZhbHNlO1xyXG5cdGxldCBpc1Bob25lID0gd2luZG93LmlubmVyV2lkdGggPD0gNDgwO1xyXG5cdGlmIChpc1Bob25lKSB7XHJcblx0XHRhY2NvcmRCbG9jay5zdHlsZS5sZWZ0ID0gYWNjb3JkQmxvY2suZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCArICdweCc7XHJcblx0fVxyXG5cclxuXHRsZXQgX3dpZHRoQ29udGVudCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0bGV0IGl0ZW1RdWFudGl0eSA9IDM7XHJcblx0XHRpZiAoaXNQaG9uZSkge2l0ZW1RdWFudGl0eSA9IDE7fVxyXG5cdFx0bGV0IGNvbXB1dGVkV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAtIGl0ZW1RdWFudGl0eSAqIHRyaWdnZXJXaWR0aDtcclxuXHJcblx0XHRyZXR1cm4gY29tcHV0ZWRXaWR0aCA+IDU0MCA/IDU0MCA6IGNvbXB1dGVkV2lkdGg7XHJcblx0fVxyXG5cclxuXHRsZXQgX3RvZ2dsZUFjY29yZGVvbiA9IGZ1bmN0aW9uKGVsZW0pIHtcclxuXHRcdGxldCBpbml0aWFsTGVmdCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gMyAqIHRyaWdnZXJXaWR0aCArICdweCc7XHJcblx0XHRpZiAoaXNDbGlja2VkKSB7XHJcblx0XHRcdGxldCBpc09wZW5lZEl0ZW1DbGlja2VkID0gZWxlbS5jbGFzc0xpc3QuY29udGFpbnMob3B0aW9ucy5pdGVtKTtcclxuXHRcdFx0bGV0IGFjdGl2ZUl0ZW0gPSBhY2NvcmRCbG9jay5xdWVyeVNlbGVjdG9yKFwiLlwiICsgb3B0aW9ucy5pdGVtKTtcclxuXHRcdFx0YWN0aXZlSXRlbS5jbGFzc0xpc3QudG9nZ2xlKG9wdGlvbnMuaXRlbSk7XHJcblx0XHRcdGFjdGl2ZUl0ZW0ucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmNvbnRlbnQpLnN0eWxlLndpZHRoID0gMDtcclxuXHRcdFx0aXNDbGlja2VkID0gZmFsc2U7XHJcblx0XHRcdGlmIChpc09wZW5lZEl0ZW1DbGlja2VkKSB7XHJcblx0XHRcdFx0aWYgKGlzUGhvbmUpIHtcclxuXHRcdFx0XHRcdGFjY29yZEJsb2NrLnN0eWxlLmxlZnQgPSBpbml0aWFsTGVmdDt9XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbGVtLmNsYXNzTGlzdC50b2dnbGUob3B0aW9ucy5pdGVtKTtcclxuXHRcdGxldCBlbGVtQ29udGVudCA9IGVsZW0ucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmNvbnRlbnQpO1xyXG5cdFx0ZWxlbUNvbnRlbnQuc3R5bGUud2lkdGggPSBfd2lkdGhDb250ZW50KCkgKyAncHgnO1xyXG5cdFx0aWYgKGlzUGhvbmUpIHtcclxuXHRcdFx0YWNjb3JkQmxvY2suc3R5bGUubGVmdCA9IFtdLmluZGV4T2YuY2FsbChhY2NvcmRCbG9jay5jaGlsZHJlbiwgZWxlbSkgKiBcclxuXHRcdFx0LSh0cmlnZ2VyV2lkdGgpICsgJ3B4JztcclxuXHRcdH1cclxuXHRcdGlzQ2xpY2tlZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XHJcblx0XHRhY2NvcmRCbG9jay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0bGV0IHRhcmdldCA9IGUudGFyZ2V0LmNsb3Nlc3QoJy4nICsgb3B0aW9ucy50cmlnZ2VyKTtcclxuXHRcdFx0aXNQaG9uZSA9IHdpbmRvdy5pbm5lcldpZHRoIDw9IDQ4MDtcclxuXHRcdFx0dHJpZ2dlcldpZHRoID0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShhY2NvcmRCbG9ja1xyXG5cdFx0XHRcdC5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMudHJpZ2dlcikpLndpZHRoKTtcclxuXHRcdFx0aWYgKHRhcmdldCkge1xyXG5cdFx0XHRcdF90b2dnbGVBY2NvcmRlb24odGFyZ2V0LnBhcmVudEVsZW1lbnQpO31cclxuXHRcdH0pXHJcblxyXG5cdFx0bGV0IGNyb3NzZXMgPSBhY2NvcmRCbG9jay5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uLWhvcl9fYnRuLWNsb3NlJyk7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGNyb3NzZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0Y3Jvc3Nlc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0X3RvZ2dsZUFjY29yZGVvbihjcm9zc2VzW2ldLmNsb3Nlc3QoJy4nICsgb3B0aW9ucy5pdGVtKSlcclxuXHRcdH0pXHJcblx0XHR9XHJcblx0XHRcclxuXHR9XHJcblxyXG5cdHJldHVybiB7aW5pdDogYWRkTGlzdGVuZXJzfTtcclxufSkoe1xyXG5cdGJsb2NrOiBcIi5hY2NvcmRlb24taG9yXCIsXHJcblx0dHJpZ2dlcjogXCJhY2NvcmRlb24taG9yX190aXRsZVwiLFxyXG5cdGl0ZW06IFwiYWNjb3JkZW9uLWhvcl9faXRlbV9hY3RpdmVcIixcclxuXHRjb250ZW50OiBcImFjY29yZGVvbi1ob3JfX2NvbnRhaW5lclwiXHJcbn0pXHJcblxyXG5hY2NvcmRlb25Ib3IuaW5pdCgpO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmNvbnN0IG1vcmVCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yZXZpZXdfX21vcmUtYnRuXCIpO1xyXG5jb25zdCB0ZW1wbGF0ZVJldiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjb3ZlcmxheS1yZXZpZXdcIikuaW5uZXJIVE1MO1xyXG5jb25zdCBzZWN0aW9uUmV2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZpZXdcIik7XHJcblxyXG5jb25zdCBvdmVybGF5UmV2aWV3ID0gY3JlYXRlUmV2aWV3KHRlbXBsYXRlUmV2KTtcclxuXHJcbmZvciAodmFyIGkgPSAwOyBpIDwgbW9yZUJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcclxuXHRtb3JlQnV0dG9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdGxldCB0YXJnZXQgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnJldmlld19fbW9yZS1idG5cIik7XHJcblx0XHRpZiAodGFyZ2V0KSB7XHJcblx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5XCIpLmNsYXNzTGlzdC5hZGQoXCJkaXNhYmxlZC1vbmVwYWdlLXNjcm9sbFwiKTtcclxuXHRcdFx0b3ZlcmxheVJldmlldy5vcGVuKHRhcmdldC5wYXJlbnRFbGVtZW50KTtcclxuXHRcdH1cclxuXHR9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVSZXZpZXcodGVtcGxhdGVJbikge1xyXG5cdGxldCB0ZW1wQmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHJcblx0dGVtcEJsb2NrLmlubmVySFRNTCA9IHRlbXBsYXRlSW47XHJcblxyXG5cdGxldCBjbG9zZUVsZW0gPSB0ZW1wQmxvY2sucXVlcnlTZWxlY3RvcihcIi5vdmVybGF5LXJldmlld19fYnRuLWNsb3NlXCIpO1xyXG5cdGxldCBvdmVybGF5RWxlbSA9IHRlbXBCbG9jay5xdWVyeVNlbGVjdG9yKFwiLm92ZXJsYXktcmV2aWV3XCIpO1xyXG5cdGxldCBhdXRob3JFbGVtID0gdGVtcEJsb2NrLnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheS1yZXZpZXdfX3RpdGxlXCIpO1xyXG5cdGxldCB0ZXh0RWxlbSA9IHRlbXBCbG9jay5xdWVyeVNlbGVjdG9yKFwiLm92ZXJsYXktcmV2aWV3X190ZXh0XCIpO1xyXG5cclxuXHR0ZW1wQmxvY2sgPSBudWxsO1xyXG5cclxuXHRvdmVybGF5RWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdGlmIChlLnRhcmdldCA9PT0gb3ZlcmxheUVsZW0pIHtcclxuXHRcdFx0Y2xvc2VFbGVtLmNsaWNrKCk7XHJcblx0XHR9XHJcblx0fSlcclxuXHJcblx0Y2xvc2VFbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcblx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keVwiKS5jbGFzc0xpc3QucmVtb3ZlKFwiZGlzYWJsZWQtb25lcGFnZS1zY3JvbGxcIik7XHJcblx0XHRzZWN0aW9uUmV2LnJlbW92ZUNoaWxkKG92ZXJsYXlFbGVtKTtcclxuXHR9KVxyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0b3BlbihpdGVtKSB7XHJcblx0XHRcdHNlY3Rpb25SZXYuYXBwZW5kQ2hpbGQob3ZlcmxheUVsZW0pO1xyXG5cdFx0XHRhdXRob3JFbGVtLmlubmVySFRNTCA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5yZXZpZXdfX2F1dGhvclwiKS5pbm5lckhUTUw7XHJcblx0XHRcdHRleHRFbGVtLmlubmVySFRNTCA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5yZXZpZXdfX3RleHRcIikuaW5uZXJIVE1MO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuY29uc3Qgb3dsQnVyZ2VyID0gJCgnLm93bC1jYXJvdXNlbCcpO1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHRvd2xCdXJnZXIub3dsQ2Fyb3VzZWwoe1xyXG5cdFx0bG9vcDogdHJ1ZSxcclxuXHRcdGl0ZW1zOiAxXHJcblx0fSk7XHJcbn0pO1xyXG5cclxuJCgnLmJ1cmdlcnNfX3ByZXYnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgIG93bEJ1cmdlci50cmlnZ2VyKCdwcmV2Lm93bC5jYXJvdXNlbCcpO1xyXG59KVxyXG5cclxuJCgnLmJ1cmdlcnNfX25leHQnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICAgIG93bEJ1cmdlci50cmlnZ2VyKCduZXh0Lm93bC5jYXJvdXNlbCcpO1xyXG59KVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4kKFwiLm1haW5cIikub25lcGFnZV9zY3JvbGwoe1xyXG4gICBzZWN0aW9uQ29udGFpbmVyOiBcInNlY3Rpb25cIiwgICAgIC8vIHNlY3Rpb25Db250YWluZXIgYWNjZXB0cyBhbnkga2luZCBvZiBzZWxlY3RvciBpbiBjYXNlIHlvdSBkb24ndCB3YW50IHRvIHVzZSBzZWN0aW9uXHJcbiAgIGVhc2luZzogXCJlYXNlXCIsICAgICAgICAgICAgICAgICAgLy8gRWFzaW5nIG9wdGlvbnMgYWNjZXB0cyB0aGUgQ1NTMyBlYXNpbmcgYW5pbWF0aW9uIHN1Y2ggXCJlYXNlXCIsIFwibGluZWFyXCIsIFwiZWFzZS1pblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBcImVhc2Utb3V0XCIsIFwiZWFzZS1pbi1vdXRcIiwgb3IgZXZlbiBjdWJpYyBiZXppZXIgdmFsdWUgc3VjaCBhcyBcImN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuNDIwLCAxLjMxMClcIlxyXG4gICBhbmltYXRpb25UaW1lOiAxMDAwLCAgICAgICAgICAgICAvLyBBbmltYXRpb25UaW1lIGxldCB5b3UgZGVmaW5lIGhvdyBsb25nIGVhY2ggc2VjdGlvbiB0YWtlcyB0byBhbmltYXRlXHJcbiAgIHBhZ2luYXRpb246IHRydWUsICAgICAgICAgICAgICAgIC8vIFlvdSBjYW4gZWl0aGVyIHNob3cgb3IgaGlkZSB0aGUgcGFnaW5hdGlvbi4gVG9nZ2xlIHRydWUgZm9yIHNob3csIGZhbHNlIGZvciBoaWRlLlxyXG4gICB1cGRhdGVVUkw6IGZhbHNlLCAgICAgICAgICAgICAgICAvLyBUb2dnbGUgdGhpcyB0cnVlIGlmIHlvdSB3YW50IHRoZSBVUkwgdG8gYmUgdXBkYXRlZCBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIHVzZXIgc2Nyb2xsIHRvIGVhY2ggcGFnZS5cclxuICAgYmVmb3JlTW92ZTogZnVuY3Rpb24oaW5kZXgpIHt9LCAgLy8gVGhpcyBvcHRpb24gYWNjZXB0cyBhIGNhbGxiYWNrIGZ1bmN0aW9uLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYmVmb3JlIHRoZSBwYWdlIG1vdmVzLlxyXG4gICBhZnRlck1vdmU6IGZ1bmN0aW9uKGluZGV4KSB7fSwgICAvLyBUaGlzIG9wdGlvbiBhY2NlcHRzIGEgY2FsbGJhY2sgZnVuY3Rpb24uIFRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhZnRlciB0aGUgcGFnZSBtb3Zlcy5cclxuICAgbG9vcDogZmFsc2UsICAgICAgICAgICAgICAgICAgICAgLy8gWW91IGNhbiBoYXZlIHRoZSBwYWdlIGxvb3AgYmFjayB0byB0aGUgdG9wL2JvdHRvbSB3aGVuIHRoZSB1c2VyIG5hdmlnYXRlcyBhdCB1cC9kb3duIG9uIHRoZSBmaXJzdC9sYXN0IHBhZ2UuXHJcbiAgIGtleWJvYXJkOiB0cnVlLCAgICAgICAgICAgICAgICAgIC8vIFlvdSBjYW4gYWN0aXZhdGUgdGhlIGtleWJvYXJkIGNvbnRyb2xzXHJcbiAgIHJlc3BvbnNpdmVGYWxsYmFjazogZmFsc2UsICAgICAgICAvLyBZb3UgY2FuIGZhbGxiYWNrIHRvIG5vcm1hbCBwYWdlIHNjcm9sbCBieSBkZWZpbmluZyB0aGUgd2lkdGggb2YgdGhlIGJyb3dzZXIgaW4gd2hpY2hcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8geW91IHdhbnQgdGhlIHJlc3BvbnNpdmUgZmFsbGJhY2sgdG8gYmUgdHJpZ2dlcmVkLiBGb3IgZXhhbXBsZSwgc2V0IHRoaXMgdG8gNjAwIGFuZCB3aGVuZXZlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgYnJvd3NlcidzIHdpZHRoIGlzIGxlc3MgdGhhbiA2MDAsIHRoZSBmYWxsYmFjayB3aWxsIGtpY2sgaW4uXHJcbiAgIGRpcmVjdGlvbjogXCJ2ZXJ0aWNhbFwiICAgICAgICAgICAgLy8gWW91IGNhbiBub3cgZGVmaW5lIHRoZSBkaXJlY3Rpb24gb2YgdGhlIE9uZSBQYWdlIFNjcm9sbCBhbmltYXRpb24uIE9wdGlvbnMgYXZhaWxhYmxlIGFyZSBcInZlcnRpY2FsXCIgYW5kIFwiaG9yaXpvbnRhbFwiLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBcInZlcnRpY2FsXCIuICBcclxufSk7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5sZXQgbmF2aWdhdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG5cdGxldCBzdGFydFBhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhcnQnKTtcclxuXHJcblx0c3RhcnRQYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG5cdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PT0gJ25hdi1tZW51X19saW5rJyB8fCBcclxuXHRcdFx0ZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtYWluLW5hdl9fYnRuJykgfHxcclxuXHRcdFx0ZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzdGFydF9fcGFnZS1kb3duJykpIHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHQkKCcubWFpbicpLm1vdmVUbyhlLnRhcmdldC5kYXRhc2V0LmluZGV4KTtcclxuXHRcdH1cclxuXHR9KVxyXG59XHJcblxyXG5uYXZpZ2F0aW9uKCk7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmxldCBzdWJtaXRPcmRlciA9IChmdW5jdGlvbigpIHtcclxuXHRsZXQgZm9ybSA9ICQoJyNvcmRlci1mb3JtJyk7XHJcblxyXG5cdGxldCBkaXNwbGF5TW9kYWwgPSBmdW5jdGlvbihtZXNzYWdlKSB7XHJcblx0XHRjb25zdCBzZWN0aW9uT3JkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3JkZXInKTtcclxuXHJcblx0XHRsZXQgdGVtcEJsb2NrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHR0ZW1wQmxvY2suaW5uZXJIVE1MID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI292ZXJsYXktb3JkZXInKS5pbm5lckhUTUw7XHJcblxyXG5cdFx0bGV0IGNsb3NlRWxlbSA9IHRlbXBCbG9jay5xdWVyeVNlbGVjdG9yKCcub3ZlcmxheS1vcmRlcl9fYnRuJyk7XHJcblx0XHRsZXQgb3ZlcmxheUVsZW0gPSB0ZW1wQmxvY2sucXVlcnlTZWxlY3RvcihcIi5vdmVybGF5LW9yZGVyXCIpO1xyXG5cdFx0bGV0IHRleHRFbGVtID0gdGVtcEJsb2NrLnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheS1vcmRlcl9fdGV4dFwiKTtcclxuXHJcblx0XHR0ZW1wQmxvY2sgPSBudWxsO1xyXG5cclxuXHRcdHRleHRFbGVtLmlubmVySFRNTCA9IG1lc3NhZ2U7XHJcblx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keVwiKS5jbGFzc0xpc3QuYWRkKFwiZGlzYWJsZWQtb25lcGFnZS1zY3JvbGxcIik7XHJcblx0XHRzZWN0aW9uT3JkZXIuYXBwZW5kQ2hpbGQob3ZlcmxheUVsZW0pO1xyXG5cclxuXHRcdG92ZXJsYXlFbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRpZiAoZS50YXJnZXQgPT09IG92ZXJsYXlFbGVtKSB7XHJcblx0XHRcdFx0Y2xvc2VFbGVtLmNsaWNrKCk7XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblxyXG5cdFx0Y2xvc2VFbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5XCIpLmNsYXNzTGlzdC5yZW1vdmUoXCJkaXNhYmxlZC1vbmVwYWdlLXNjcm9sbFwiKTtcclxuXHRcdFx0c2VjdGlvbk9yZGVyLnJlbW92ZUNoaWxkKG92ZXJsYXlFbGVtKTtcclxuXHRcdH0pXHJcblx0fVxyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXIgPSBmdW5jdGlvbigpIHtcclxuXHRcdGZvcm0ub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0bGV0XHRkYXRhID0gZm9ybS5zZXJpYWxpemUoKSxcclxuXHRcdFx0XHR0eXBlID0gZm9ybS5hdHRyKCdtZXRob2QnKSxcclxuXHRcdFx0XHR1cmwgPSBmb3JtLmF0dHIoJ2FjdGlvbicpO1xyXG5cclxuXHRcdFx0bGV0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG5cdFx0XHRcdHR5cGU6IHR5cGUsXHJcblx0XHRcdFx0dXJsOiB1cmwsXHJcblx0XHRcdFx0ZGF0YVR5cGU6ICdKU09OJyxcclxuXHRcdFx0XHRkYXRhOiBkYXRhXHJcblx0XHRcdH0pLmRvbmUoZnVuY3Rpb24obXNnKSB7XHJcblx0XHRcdFx0ZGlzcGxheU1vZGFsKG1zZy5tZXMpO1xyXG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKGpxWEhSLCB0ZXh0U3RhdHVzKSB7XHJcblx0XHQgICAgICAgIGFsZXJ0KFwiUmVxdWVzdCBmYWlsZWQ6IFwiICsgdGV4dFN0YXR1cyk7XHJcblx0XHQgICAgfSk7XHJcblx0XHR9KVxyXG5cdH1cclxuXHJcblx0cmV0dXJuIHtpbml0OiBhZGRMaXN0ZW5lcn07XHJcbn0pKCk7XHJcblxyXG5zdWJtaXRPcmRlci5pbml0KCk7Il19
